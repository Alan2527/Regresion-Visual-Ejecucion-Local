name: ğŸ‘ï¸ RegresiÃ³n Visual - DESKTOP PROD

on:
  workflow_dispatch:
    inputs:
      version_number:
        description: 'NÃºmero de versiÃ³n a testear'
        required: true
        default: '0'

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  run_regression_and_deploy:
    runs-on: self-hosted
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: â¬‡ï¸ Checkout del cÃ³digo
        uses: actions/checkout@v4
          
      # 1. EJECUCIÃ“N DEL SCRIPT
      - name: ğŸš€ Ejecutar RegresiÃ³n Visual
        shell: cmd
        run: |
          @echo off
          REM La configuraciÃ³n de UTF-8 es CRÃTICA
          chcp 65001
          set PYTHONIOENCODING=utf-8
          
          REM Limpiar reportes viejos 
          if exist "Reportes HTML - TN - DESKTOP - PROD" (
            rmdir /s /q "Reportes HTML - TN - DESKTOP - PROD"
          )
          
          py regre_visual_tn_desk_prod.py ${{ inputs.version_number }}

      # 2. Renombrar el HTML generado a index.html
      - name: ğŸ“ Renombrar a index.html para Pages
        shell: powershell
        run: |
          cd "Reportes HTML - TN - DESKTOP - PROD"
          Get-ChildItem -Filter "Reporte_DOM_Estructural_*.html" | Rename-Item -NewName "index.html"
          
      # 3. ConfiguraciÃ³n del Entorno de Pages
      - name: âš™ï¸ Configurar GitHub Pages
        uses: actions/configure-pages@v5

      # 4. Cargar el Reporte para Despliegue (Debe funcionar con la ruta simple)
      - name: â¬†ï¸ Cargar Reporte para Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'Reportes HTML - TN - DESKTOP - PROD'

      # 5. Desplegar a GitHub Pages
      - name: ğŸŒ Desplegar a GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
