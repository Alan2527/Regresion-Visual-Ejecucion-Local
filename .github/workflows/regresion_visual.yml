name:  Regresi贸n Visual - DESKTOP PROD

# Se ejecuta manualmente, solicitando la versi贸n
on:
  workflow_dispatch:
    inputs:
      version_number:
        description: 'N煤mero de versi贸n a testear'
        required: true
        default: '0'

# Permisos necesarios para poder subir el reporte a GitHub Pages
permissions:
  contents: write

jobs:
  run_regression_and_deploy:
    runs-on: self-hosted # Ejecuta en tu m谩quina local

    steps:
      - name: 猬锔 Checkout del c贸digo
        uses: actions/checkout@v4

      # 1. Limpieza de reportes anteriores y Preparaci贸n de Entorno
      - name: Ч Limpiar y Configurar Encoding (UTF-8)
        shell: cmd
        run: |
          @echo off
          REM Borrar reportes viejos para asegurar un despliegue limpio
          if exist "Reportes HTML - TN - DESKTOP - PROD" (
            rmdir /s /q "Reportes HTML - TN - DESKTOP - PROD"
          )
          
          REM Soluci贸n al UnicodeEncodeError y los caracteres especiales
          chcp 65001
          set PYTHONIOENCODING=utf-8
          
      # 2. Ejecuci贸n del Script de Python
      - name:  Ejecutar Regresi贸n Visual
        # Usamos cmd/PowerShell por defecto, el encoding ya fue configurado
        run: py regre_visual_tn_desk_prod.py ${{ inputs.version_number }}

      # 3. Renombrar el HTML generado
      - name:  Renombrar a index.html para Pages
        shell: powershell
        run: |
          # Navegamos a la carpeta de reportes generada por el script.
          cd "Reportes HTML - TN - DESKTOP - PROD"
          
          # Buscamos el archivo HTML que contiene la marca de tiempo y lo renombramos a index.html
          Get-ChildItem -Filter "Reporte_DOM_Estructural_*.html" | Rename-Item -NewName "index.html"
          
      # 4. Backup (Opcional pero Recomendado): Subir como Artifact ZIP
      - name:  Subir Artefacto (Backup)
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: Backup-Reporte-v${{ inputs.version_number }}-${{ github.run_id }}
          path: "Reportes HTML - TN - DESKTOP - PROD"

      # 5. Publicaci贸n en GitHub Pages
      - name:  Publicar Reporte Web (GitHub Pages)
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: "Reportes HTML - TN - DESKTOP - PROD" # La carpeta que se despliega
          branch: gh-pages # La rama donde se guardar谩n los archivos web
